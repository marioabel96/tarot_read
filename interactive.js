//STEP DEVIL!!!
const prompt = require('prompt-sync')();

let spacer = prompt('\n \nHello young one, your curious about your future I see. Hmmmmmm.');
let spacer1 = prompt('\n \nGet closer, I know is dark in here but dont be afraid. Come, come young one.');
console.log('\n \n')
const name = prompt('What is your name? ');
let spacer4 = prompt('\n \nNice to meet you, yeah nice to meet you ' + name);

// devil ascii art
//console.log("\n \n .-._                                                   _,-,\r\n  `._`-._                                           _,-\'_,\'\r\n     `._ `-._                                   _,-\' _,\'\r\n        `._  `-._        __.-----.__        _,-\'  _,\'\r\n           `._   `#===\"\"\"           \"\"\"===#\'   _,\'\r\n              `._\/)  ._               _.  (\\_,\'\r\n               )*\'     **.__     __.**     \'*( \r\n               #  .==..__  \"\"   \"\"  __..==,  # \r\nDeelkar        #   `\"._(_).       .(_)_.\"\'   #")

let spacer5 = prompt('\n \nLet my see your face up close '+ name);
let spacer6 = prompt("\n \n                       ,---.\r\n                       \/    |\r\n                      \/     |\r\n                     \/      |\r\n                    \/       |\r\n               ___,\'        |\r\n             <  -\'          :\r\n              `-.__..--\'``-,_\\_\r\n                 |o\/ ` :,.)_`>\r\n                 :\/ `     ||\/)\r\n                 (_.).__,-` |\\\r\n                 \/( `.``   `| :\r\n                 \\\'`-.)  `  ; ;\r\n                 | `       \/-<\r\n                 |     `  \/   `.\r\n ,-_-..____     \/|  `    :__..-\'\\\r\n\/,\'-.__\\\\  ``-.\/ :`      ;       \\\r\n`\\ `\\  `\\\\  \\ :  (   `  \/  ,   `. \\\r\n  \\` \\   \\\\   |  | `   :  :     .\\ \\\r\n   \\ `\\_  ))  :  ;     |  |      ): :\r\n  (`-.-\'\\ ||  |\\ \\   ` ;  ;       | |\r\n   \\-_   `;;._   ( `  \/  \/_       | |\r\n    `-.-.\/\/ ,\'`-._\\__\/_,\'         ; |\r\n       \\:: :     \/     `     ,   \/  |\r\n        || |    (        ,\' \/   \/   |\r\n        ||                ,\'   \/ SSt|")
let spacer8 = prompt('\n \nI see, I see now');
let spacer7 = prompt('\n \nRelax and let my friend shuffle the cards');
console.log('\n\n\n\n\n\n')
let spacer9 = prompt("            )            (\r\n           \/(   (\\___\/)  )\\\r\n          ( #)  \\ (\'\')| ( #\r\n           ||___c\\  > \'__||\r\n           ||**** ),_\/ **\'|\r\n     .__   |\'* ___| |___*\'|\r\n      \\_\\  |\' (    ~   ,)\'|\r\n       ((  |\' \/(.  \'  .)\\ |\r\n        \\\\_|_\/ <_ _____> \\______________\r\n         \/   \'-, \\   \/ ,-\'      ______  \\\r\nb\'ger   \/      (\/\/   \\\\)     __\/     \/   \\\r\n                            \'.\/_____\/")
let spacer10 = prompt('\n \nYou must understand my friend, that this demon knows the Fisher-Yates algorithm.\nSo all permutations are equally possible. This means there is no escape for the destiny your about to see\nBe aware of this '+name);
let spacer11 = prompt('\n \nLet the shuffle begin')
let spacer12 = prompt("      _____\r\n     |\\ ~ \/|\r\n     |}}:{{|\r\n     |}}:{{|  _____\r\n     |}}:{{| |Joker|\r\n     |\/_~_\\| |==%, |\r\n             | \\\/>\\|\r\nejm98        | _>^^|           _____\r\n   _____     |\/_\\\/_|    _____ |6    |\r\n  |2    | _____        |5    || ^ ^ | \r\n  |  ^  ||3    | _____ | ^ ^ || ^ ^ | _____\r\n  |     || ^ ^ ||4    ||  ^  || ^ ^ ||7    |\r\n  |  ^  ||     || ^ ^ || ^ ^ ||____9|| ^ ^ | _____\r\n  |____Z||  ^  ||     ||____S|       |^ ^ ^||8    | _____\r\n         |____E|| ^ ^ |              | ^ ^ ||^ ^ ^||9    |\r\n                |____h|              |____L|| ^ ^ ||^ ^ ^|\r\n                            _____           |^ ^ ^||^ ^ ^|\r\n                    _____  |K  WW|          |____8||^ ^ ^|\r\n            _____  |Q  ww| | ^ {)|                 |____6|\r\n     _____ |J  ww| | ^ {(| |(.)%%| _____\r\n    |10 ^ || ^ {)| |(.)%%| | |%%%||A .  |\r\n    |^ ^ ^||(.)% | | |%%%| |_%%%>|| \/.\\ |\r\n    |^ ^ ^|| | % | |_%%%O|        |(_._)|\r\n    |^ ^ ^||__%%[|                |  |  |\r\n    |___0I|                       |____V|\r\n                               _____\r\n   _____                _____ |6    |\r\n  |2    | _____        |5    || & & | \r\n  |  &  ||3    | _____ | & & || & & | _____\r\n  |     || & & ||4    ||  &  || & & ||7    |\r\n  |  &  ||     || & & || & & ||____9|| & & | _____\r\n  |____Z||  &  ||     ||____S|       |& & &||8    | _____\r\n         |____E|| & & |              | & & ||& & &||9    |\r\n                |____h|              |____L|| & & ||& & &|\r\n                            _____           |& & &||& & &|\r\n                    _____  |K  WW|          |____8||& & &|\r\n            _____  |Q  ww| | o {)|                 |____6|\r\n     _____ |J  ww| | o {(| |o o%%| _____\r\n    |10 & || o {)| |o o%%| | |%%%||A _  |\r\n    |& & &||o o% | | |%%%| |_%%%>|| ( ) |\r\n    |& & &|| | % | |_%%%O|        |(_\'_)|\r\n    |& & &||__%%[|                |  |  |\r\n    |___0I|                       |____V|\r\n                               _____\r\n   _____                _____ |6    |\r\n  |2    | _____        |5    || v v | \r\n  |  v  ||3    | _____ | v v || v v | _____\r\n  |     || v v ||4    ||  v  || v v ||7    |\r\n  |  v  ||     || v v || v v ||____9|| v v | _____\r\n  |____Z||  v  ||     ||____S|       |v v v||8    | _____\r\n         |____E|| v v |              | v v ||v v v||9    |\r\n                |____h|              |____L|| v v ||v v v|\r\n                            _____           |v v v||v v v|\r\n                    _____  |K  WW|          |____8||v v v|\r\n            _____  |Q  ww| |   {)|                 |____6|\r\n     _____ |J  ww| |   {(| |(v)%%| _____\r\n    |10 v ||   {)| |(v)%%| | v%%%||A_ _ |\r\n    |v v v||(v)% | | v%%%| |_%%%>||( v )|\r\n    |v v v|| v % | |_%%%O|        | \\ \/ |\r\n    |v v v||__%%[|                |  .  |\r\n    |___0I|                       |____V|\r\n                               _____\r\n   _____                _____ |6    |\r\n  |2    | _____        |5    || o o | \r\n  |  o  ||3    | _____ | o o || o o | _____\r\n  |     || o o ||4    ||  o  || o o ||7    |\r\n  |  o  ||     || o o || o o ||____9|| o o | _____\r\n  |____Z||  o  ||     ||____S|       |o o o||8    | _____\r\n         |____E|| o o |              | o o ||o o o||9    |\r\n                |____h|              |____L|| o o ||o o o|\r\n                            _____           |o o o||o o o|\r\n                    _____  |K  WW|          |____8||o o o|\r\n            _____  |Q  ww| | \/\\{)|                 |____6|\r\n     _____ |J  ww| | \/\\{(| | \\\/%%| _____\r\n    |10 o || \/\\{)| | \\\/%%| |  %%%||A ^  |\r\n    |o o o|| \\\/% | |  %%%| |_%%%>|| \/ \\ |\r\n    |o o o||   % | |_%%%O|        | \\ \/ |\r\n    |o o o||__%%[|                |  .  |\r\n    |___0I|                       |____V|") 
let spacer13 = prompt('\n \nNow ' + name + ' give me number so we can cut the cards at that height\n\n It must be, It must be between 1 and 78');
console.log('\n \n')
let num = prompt('Enter the number: ');

if (num > 78) {
    let spacer14 = prompt('\n \nDont play with the devils my friend, that number is not on the range. Now i will chose your number');
    let spacer15 = prompt('\n \nHAHAHA Remeber there is no scape from it');
    console.log("\n \n   , ,, ,                              \r\n   | || |    ,\/  _____  \\.             \r\n   \\_||_\/    ||_\/     \\_||             \r\n     ||       \\_| . . |_\/              \r\n     ||         |  L  |                \r\n    ,||         |`===\'|                \r\n    |>|      ___`>  -<\'___             \r\n    |>|\\    \/             \\            \r\n    \\>| \\  \/  ,    .    .  |           \r\n     ||  \\\/  \/| .  |  . |  |           \r\n     ||\\  ` \/ | ___|___ |  |     (     \r\n  (( || `--\'  | _______ |  |     ))  ( \r\n(  )\\|| (  )\\ | - --- - | -| (  ( \\  ))\r\n(\\\/  || ))\/ ( | -- - -- |  | )) )  \\(( \r\n ( ()||((( ())|         |  |( (( () )hjm")
}

//fix number if need
function fixNumber(num) {
    if (num >= 75 && num < 79) { num = num-3}
    else if (num < 0 || num >= 79 || num === 0){num = 39}
    else {return num;}
}
num = fixNumber(num) // save new num

let spacer16 = prompt('\n \nNow that we cut the cards, lets reveal one by one\nRemember that from all the scenarios possible this will be your destiny')
let sapceras17 = prompt("\n \n .-._                                                   _,-,\r\n  `._`-._                                           _,-\'_,\'\r\n     `._ `-._                                   _,-\' _,\'\r\n        `._  `-._        __.-----.__        _,-\'  _,\'\r\n           `._   `#===\"\"\"           \"\"\"===#\'   _,\'\r\n              `._\/)  ._               _.  (\\_,\'\r\n               )*\'     **.__     __.**     \'*( \r\n               #  .==..__  \"\"   \"\"  __..==,  # \r\nDeelkar        #   `\"._(_).       .(_)_.\"\'   #")

let sapcer18 = prompt('\n \n I will pull 3 cards out of my deck now and your fortune will be know \npress enter when your ready \n\n')


// STEP 0: Export arcana and tarot objects from cards.js
const myModule = require("./cards.js");
const tarot = myModule.tarot;
const arcana = myModule.arcana;


// STEP 1: SHUFFLE CARDS
// Function that shuffle cards using Fisher-Yates algorithm
const fisherYates = (toShuffle = []) => {
    for (let i = (toShuffle.length - 1); i > 0; i -= 1) {
      const randomIndex = Math.floor(Math.random() * (i + 1));
      [toShuffle[i], toShuffle[randomIndex]] = [toShuffle[randomIndex], toShuffle[i]];
    }
    return toShuffle;
    // source: https://medium.com/javascript-by-doing/learn-fisher-yates-shuffle-in-javascript-275881d36650
  }

//console.log(cards); //Should return cards shuffled


// STEP 2: LET USER CUT CARDS
let cards = fisherYates(Object.keys(tarot)).slice((num-3),num)


// STEP 3: RETURN THE POSTION OF THE CARD (UPRIGHT OR REVRSED)
function randomPosition(cards) {
    let position = [];
    for (i = 0; i < cards.length; i++) {
        let random = Math.floor(Math.random()*2)
        if (random === 1) {
            position.push('_upright')
        } else {
            position.push('_reversed')
        }
    }

    return position
}
const positions = randomPosition(cards); // should return array of postions to match cards
//console.log(positions) 


// STEP 4: READ THE CARDS
// the type of card split + the propierties of the split
const split3 = ['Romance', 'Career', 'Finances']
const splitMeanings = Object.keys(tarot._world._position._reversed._meaning)


function readCards(cards, positions, split, splitMeanings) {
    for (i = 0; i < cards.length; i++) {
        console.log('\n' + split[i] + ' card => ' + tarot[cards[i]]._name.toUpperCase()) // log first card
        console.log('------------------------------------')
        console.log('Part of the ' + tarot[cards[i]]._arcana + ' set, ' + arcana._set[tarot[cards[i]]._arcana]) // log Arcana
        if (tarot[cards[i]]._suit) {   // if for checking card suit exist 
                console.log('Belongs to the "' + tarot[cards[i]]._suit + '" family, ' + arcana._suit[tarot[cards[i]]._suit]) // log suit no suit for majors
            }
        console.log('Position: '+ tarot[cards[i]]._position[positions[i]]._position) //log first position
        console.log('The card in this position indicates signs of: ' + tarot[cards[i]]._position[positions[i]]._keywords) //log keywords
        console.log('Meaning in '+ split[i] + ': ' + tarot[cards[i]]._position[positions[i]]._meaning[splitMeanings[i]]+ '\n')
        let sapcesadr18 = prompt('\n \n Press enter when you have finished reading it')
    }
}

readCards(cards, positions, split3, splitMeanings); // should return the fortune of the user :)




/* EXTRA ESPECIAL MESSAGE */
// if all cards are major arcana or from the same suit, logs a special message

const allEqual = arr => arr.every( v => v === arr[0] )

function specialMessage(cards) {
    let arcanas = [];
    let suits = [];
    //fill arcana array
    for (i = 0; i < cards.length; i++) {
        arcanas.push(tarot[cards[i]]._arcana)
    }
    //fill suits array
    for (i = 0; i < cards.length; i++) {
        suits.push(tarot[cards[i]]._suit)
    }

    if (allEqual(arcanas) && arcanas[0] === 'Major Arcana') {
        console.log('*Special message*')
        console.log('Your tarot reading is full of Major Arcana cards, this means an important lesson or shift is happening. It means potentially life-changing energy is present.')
    } else if (allEqual(suits)) {
        console.log('*All your cards are from the same suit => ' + suits[0] + '*')
        if (suits[0] === 'Suit of Wands') {    
            console.log("The wands imbue their users with primal energy, for it is through them that the cycle of creation can begin. Because of their ability to bring energy into any situation, they are also associated with action, ambition and making plans. At their worst, they can refer to situations that are filled with recklessness and lack of direction. As you follow the journey within the wands, you'll come across these themes again and again.")
        } else if (suits[0] === 'Suit of Cups') {    
            console.log("They frequently talk about relationships, whether romantic or otherwise, and one's imagination and inner world.  At their worst, the cups suit is fret with uncontrolled feelings, fantasy, and a disconnect with one's inner voice.")
        } else if (suits[0] === 'Suit of Swords') {    
            console.log("These cards focus on the faculty and power of intellect, which like the swords themselves, are double-edged. This can be used for both good or evil, to help and to harm, and our greatest conflicts usually come from this delicate balance. At their worst, the swords can be abusive, harsh, and lack empathy.")
        } else {    
            console.log("They are usually concerned with your long term future, career, generosity, your household, business investments and your feelings of sensuality. The negative side of the pentacles show up as greed, jealousy, miserliness, and unbridled ambition at the cost of all else.")
        }
    }
}

specialMessage(cards); // Should return special message

// console.log(Object.keys(tarot).length)// just to verify te total of cards

console.log("\n \n                              .-\"\/   .-\"\/\r\n                             \/  (.-.\/  (\r\n                            \/           \\      .^.\r\n                           |  -=- -=-    |    (_|_)\r\n                            \\   \/       \/      \/\/ \r\n                             \\  .=.    \/       \\\\\r\n                        ___.__`..;._.-\'---...  \/\/\r\n                  __.--\"        `;\'     __   `-.  \r\n        -===-.--\"\"      __.,              \"\"-.  \".\r\n          \'=_    __.---\"   | `__    __\'   \/ .\'  .\'\r\n          `\'-\"\"\"\"           \\             .\'  .\'\r\n                             |  __ __    \/   |\r\n This is all from my part.   |  __ __   \/\/`\'`\'\r\n But please remember,        |         \' | \/\/\r\n whenever you feel the       |    .      |\/\/\r\n need to know your destiny.. .\'`., , ,,,.`\'.\r\n                           .\'`\',.\',`.` ,.\'.`\r\n                            \',\',,,,.\'...\',,\'\r\n                            \'..,\',`\'.`,`,.\',\r\n                           ,\'\'.,\'.,;\',.\'.`.\'\r\n                           \'.`.\',`,;\',\',;,.;\r\n                            \',`\'.`\';\',\',`\',.\r\n                             |     |     |\r\n                             (     (     | AsH")
let sapceasdasras17 = prompt('')
console.log("\n \n .-._                                                   _,-,\r\n  `._`-._                                           _,-\'_,\'\r\n     `._ `-._                                   _,-\' _,\'\r\n        `._  `-._        __.-----.__        _,-\'  _,\'\r\n           `._   `#===\"\"\"           \"\"\"===#\'   _,\'\r\n              `._\/)  ._               _.  (\\_,\'\r\n               )*\'     **.__     __.**     \'*( \r\n               #  .==..__  \"\"   \"\"  __..==,  # \r\nDeelkar        #   `\"._(_).       .(_)_.\"\'   #")
console.log('\n \nCome back to me... '+ name)